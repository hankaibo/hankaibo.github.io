---
title: "TeamViewer替代方案之OpenVPN"
date: 2019-10-08T19:29:32+08:00
draft: false
keywords: ["OpenVPN", "TeamViewer", "内网穿透", "远程办公"]
description: "OpenVPN替换TeamViewer"
tags: ["TeamViewer", "OpenVPN"]
categories: ["Network"]
author: "hankaibo"
---

时隔多日，正好公司同事需要使用OpenVPN，我有点时间就研究安装试了试。

从网上搜索了下，文章一大堆，方式主要有三种，简单说明一下。

第一种，就是最传统的方式，手动更新依赖包，安装OpenVPN的各种依赖，手动配置证书等等；

第二种，有大神网友写了安装脚本，对方式一进行了封装，只要运行安装脚本即可；

第三种，与方式二相似，只不过是基于docker的环境，正好前段时间简单研究了下docker，并应用在自己的项目中，故使用它。

安装步骤参考官方说明，经过一番折腾，略为明白了，现记录如下：

## 服务端配置：

1. 定义临时变量
    
    ```shell script
    # 这个变量是方便下面命令行引用，如果不定义，直接使用确定的路径也可以。临时的意思是，关闭终端后，这个变量就不在存在了。
    OVPN_DATA = "ovpn-data-example"
    ```
   
2. 初始化数据卷及运行openVPN容器

    ```shell script
    # 创建数据卷，避免污染镜像
    docker volume create --name $OVPN_DATA
    # 拉取最新的镜像，并运行它为一个容器，VPN.SERVERNAME.COM 换成你的域名或者IP地址
    docker run -v $OVPN_DATA:/etc/openvpn --log-driver=none --rm kylemanna/openvpn ovpn_genconfig -u udp://VPN.SERVERNAME.COM
    # 配置秘钥，这里会有交互提示，输入密码、重复密码、证书名称、再次密码(这个密码是用来生成客户端秘钥文件时使用的，可以防止他人随意使用 openVPN 服务器端生成客户端秘钥。)
    docker run -v $OVPN_DATA:/etc/openvpn --log-driver=none --rm -it kylemanna/openvpn ovpn_initpki
    ```
   
3. 启动OpenVPN服务端
    ```shell script
    docker run -v $OVPN_DATA:/etc/openvpn -d -p 1194:1194/udp --cap-add=NET_ADMIN kylemanna/openvpn
    ```
   
4. 生成客户端证书
    ```shell script
    # CLIENTNAME 为要客户端名称，比如张三使用，就用 zhangsan 之类的标示一下。nopass 说明不需要密码，就是客户端连接时不里奇发密码。
    # 如果上个步骤配置了生成密码，就输入上面的密码（使用上面步骤2配置的密码，才能生成客户端秘钥）。
    docker run -v $OVPN_DATA:/etc/openvpn --log-driver=none --rm -it kylemanna/openvpn easyrsa build-client-full CLIENTNAME nopass
    ```
   
5. 导出客户端配置
    ```shell script
    # CLIENTNAME.ovpn 就是要生成的客户端配置，下文客户端需要使用它。
    docker run -v $OVPN_DATA:/etc/openvpn --log-driver=none --rm kylemanna/openvpn ovpn_getclient CLIENTNAME > CLIENTNAME.ovpn
    ```
   
## 客户端配置：

1. 下载

    从官网下载相应的客户端安装程序，网址[https://openvpn.net/community-downloads/](https://openvpn.net/community-downloads/) (可能需要科学上网)。
    
2. 安装

    依 Windows 为例，就是下一步、下一步。
    
3. 安装秘钥

    将服务端生成的 CLIENTNAME.ovpn 放到程序的安装目录config下，例如我的是 C:\Program Files\OpenVPN\config 目录。
    
    或者运行之后，使用【导入配置文件...】，将其导入。
    
4. 运行

    启动客户端程序，选择连接即可。
    

## 参考：

* [https://github.com/kylemanna/docker-openvpn](https://github.com/kylemanna/docker-openvpn)
 
* [https://www.dgstack.cn/archives/2498.html](https://www.dgstack.cn/archives/2498.html)

* [http://blog.joylau.cn/2018/11/21/Docker-OpenVPN/](http://blog.joylau.cn/2018/11/21/Docker-OpenVPN/)

* [https://neversec.top/20190515/openvqn.html#%E5%89%8D%E8%A8%80](https://neversec.top/20190515/openvqn.html#%E5%89%8D%E8%A8%80)

* [https://zlxdike.github.io/2019/04/28/OpenVpn%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/](https://zlxdike.github.io/2019/04/28/OpenVpn%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/)


    

