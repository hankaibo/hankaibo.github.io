---
title: "构建你自己的React（机器翻译）"
date: 2020-10-28T14:09:49+08:00
draft: false
keywords: ["react"]
description: ""
tags: []
categories: []
author: "hankaibo"
---
原文地址：[https://pomb.us/build-your-own-react/](https://pomb.us/build-your-own-react/)

我们打算从头开始重写React。一步一步。遵循真实的React代码中的体系架构，但是不包含任何优化和非必要的功能。

如果您阅读过[我以前任一“构建你自己的React”文章](https://engineering.hexacta.com/didact-learning-how-react-works-by-building-it-from-scratch-51007984e5c5)，这篇的不同之处是它基于React 16.8，因此我们现在可以使用hooks并删除所有与类相关的代码。

您可以找到旧博客文章的历史记录，并在[Didact](https://github.com/pomber/didact)仓库中找到代码。还有一个[演讲](https://www.youtube.com/watch?v=8Kc2REHdwnQ&feature=youtu.be)涉及相同的内容。但本篇是自成体系的文章。

从头开始，我们将把所有这些东西一个一个添加到我们的React版本中。

- 第一步：createElement函数
- 第二步：render函数
- 第三步：并发模式
- 第四步：
- 第五步：Render和Commit阶段
- 第六步：
- 第七步：Function组件
- 第八步：Hooks

### 步骤零：审查
但是首先让我们回顾一些基本概念。如果你已经很好地了解了React,JSX和DOM元素是如何工作的，那么可以跳过这一步。

我们将使用的这个React app，只有三行代码。第一行代码定义一个React元素。接下来的一行代码从DOM获取一个node节点。最后一行代码将React元素渲染到容器。

让我们删除所有与React相关的代码，并用普通的JavaScript替换它。

第一行是用JSX定义的元素。它甚至不是有效的JavaScript，所以为了用普通JS替换它，首先我们需要用普通JS替换它。

JSX通过像Babel这样的构建工具转换为JS。转换通常很简单：用对createElement的调用替换标记内的代码，将标签tag名称，属性props和子元素children作为参数传递。

React.createElement根据其参数创建一个对象。除了一些验证，这就是它做的一切。这样我们可以安全地将函数调用替换为其输出。

这就是元素，一个有两个属性的对象：type和props（好吧，它有更多属性，但我们只关心这两个）。

type 是一个字符串，它指定我们想要创建的DOM node节点的类型，当你想要创建一个HTML element时传递给document.createElement的标签名称tagName。它也可以是一个函数，但我们把它留到第七步。

props 是另一个对象，它有来自JSX属性的所有键值对。它还有一个特殊的属性：子元素children。

children 在本示例中是一个字符串，但它通常是包含更多元素的数组。这就是为什么元素也是树的原因。

我们需要替换的另一部分React代码是对ReactDOM.render的调用。

render 是React改变DOM的地方，所以让我们自己来做更新。

首先，我们使用元素类型（在本例中为h1)创建一个node节点。

然后，我们将所有元素属性props分配给该节点。在这里只有title。

为了避免混淆，我将使用element表示React元素，使用node表示DOM元素。

然后，我们为子元素children创建node。我们只有一个字符串作为children，因此我们创建了一个文本node。

使用textNode而不是设置innerText将允许我们以后以相同的方式处理所有元素。另请注意，我们如何像设置h1标题一样设置nodeValue，就像字符串带有props一样：{nodeValue: "hello"}。

最后，我们将textNode附加到h1，并将h1附加到容器。

现在我们有了和以前一样的应用程序，但是没有使用React。
